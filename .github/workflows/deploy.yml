name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      - run: npm install
      # 关键修改1：构建输出到 dist/blog 目录（子目录前缀为 blog）
      - run: npm run build -- --outDir dist/blog  # 仅适用于 Vite/React/Vue 等支持 --outDir 参数的项目
        # 如果你的项目是其他构建工具（如 Next.js/Gatsby），需要替换为对应配置：
        # Next.js: 需在 next.config.js 中设置 distDir: 'dist/blog'，然后运行 npm run build
        # Gatsby: 运行 gatsby build --prefix-paths --out-dir dist/blog
        # Hexo: 运行 hexo generate -d --public-dir dist/blog
      # 上传包含子目录的构建产物（dist 目录下会有 blog 子目录）
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist  # 注意：这里上传整个 dist 目录，而非 dist/blog

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}/blog  # 关键修改2：URL 拼接子目录
    runs-on: ubuntu-latest
    needs: build
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4
        with:
          # 关键修改3：指定部署根目录为上传产物中的 blog 子目录
          artifact_name: github-pages
          path: blog  # 对应上传的 dist/blog 目录（上传时 artifact 包含 dist 下的所有内容，这里直接指定子目录名）
